{"version":3,"file":null,"sources":["/home/adrien/Projects/education/udacity_fsnd/fsnd_p3/fsnd_p3_vm/vagrant/catalog/src/js/utils.js","/home/adrien/Projects/education/udacity_fsnd/fsnd_p3/fsnd_p3_vm/vagrant/catalog/src/js/auth.js","/home/adrien/Projects/education/udacity_fsnd/fsnd_p3/fsnd_p3_vm/vagrant/catalog/src/js/index.js"],"sourcesContent":["// REF: https://developer.mozilla.org/en/docs/Web/API/WindowBase64/Base64_encoding_and_decoding\nexport function b64EncodeUnicode(str) {\n  return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,\n    function toSolidBytes(match, p1) {\n      return String.fromCharCode('0x' + p1);\n    }))\n}\n\nexport function loadScript(url) {\n  var id = b64EncodeUnicode(url)\n  var script = document.getElementById(id)\n  if(script)\n    return Promise.resolve(script)\n  script = document.createElement('script')\n  script.setAttribute('defer', '')\n  script.setAttribute('async', '')\n  var head = document.getElementsByTagName('head')[0]\n  var p = new Promise(function(res, rej) {\n    script.id = id\n    script.onload = function(ev) {\n      res(script)\n    }\n    script.onerror = function(ev) {\n      rej(script)\n    }\n    script.src = url\n    head.append(script)\n  })\n  return p\n}\n","import { loadScript } from './utils.js'\nvar print = console.log.bind(console)\n\n\nexport default class Auth {\n  constructor({provider, scriptSrc, cred}) {\n    if(!(provider && scriptSrc && cred))\n      throw 'Must have a provider, scriptSrc, and cred arg'\n\n    this.provider = provider\n    this.scriptSrc = scriptSrc\n    this.cred = cred\n\n    if(provider == 'google') {\n      this.signin = this.googleSignin\n      this.signout = this.googleSignout\n    }\n    else if(provider == 'facebook') {\n      this.signin = this.facebookSignin\n      this.signout = this.facebookSignout\n    }\n    else {\n      throw 'Unknown provider ' + provider\n    }\n  }\n\n  get googleUser() {\n    if(this.ga)\n      return this.ga.currentUser.get()\n    else\n      return null\n  }\n\n  get googleIsIn() {\n    if(this.ga)\n      return this.ga.isSignedIn.get()\n    else\n      null\n  }\n\n  get googleIsOut() {\n    return !this.isIn\n  }\n\n  googleSignin() {\n    var self = this\n    return loadScript(self.scriptSrc)\n    .then(s => {\n      return new Promise(function(res, rej) {\n        gapi.load('auth2', function() {res()})\n      })\n    })\n    .then(() => {\n      return gapi.auth2.init(self.cred).then()\n    })\n    .then(() => {\n      self.ga = gapi.auth2.getAuthInstance()\n      return self.ga.grantOfflineAccess()\n    })\n    .then(resp => {\n      return fetch('/api/auth/', {\n        method: 'get',\n        credentials: 'include',\n        headers: {\n          'X-Requested-With': 'Fetch',\n          'Authorization': 'Google ' + resp.code\n        }\n      })\n    })\n    .then(resp => Promise.all([resp, resp.json()]))\n    .then(([resp, json]) => {\n      if(!resp.ok)\n        throw json\n      return json\n    })\n    .then(resp => {\n      print(resp)\n    })\n    .catch(err => {\n      print(err)\n      alert('Could not authenticate with Google.')\n    })\n  }\n\n  googleSignout() {\n    if(gapi && gapi.auth2) {\n      return gapi.auth2.getAuthInstance().signOut();\n    }\n    else\n      return Promise.reject()\n  }\n\n  googleIsAuthorized() {\n    if(this.user)\n      return this.user.hasGrantedScopes(this.cred.scope)\n    else\n      return null\n  }\n\n  get facebookUser() {\n\n  }\n\n  facebookSignin() {\n    var self = this\n    return loadScript(self.scriptSrc)\n    .then(function(s) {\n      return FB.init(self.cred)\n    })\n    .then(function() {\n      return new Promise((res, rej) => {\n        FB.login(resp => {\n          if(resp.status == 'connected' && resp.authResponse)\n            res(resp)\n          else\n            rej(resp)\n        }, {scope: self.cred.scope, return_scopes: true})\n      })\n    })\n    .then(function(resp) {\n      return fetch('/api/auth/', {\n        method: 'get',\n        credentials: 'include',\n        headers: {\n          'X-Requested-With': 'Fetch',\n          'Authorization': 'Facebook ' + resp.authResponse.accessToken\n        }\n      })\n    })\n    .then(resp => Promise.all([resp, resp.json()]))\n    .then(([resp, json]) => {\n      if(!resp.ok)\n        throw json\n      return json\n    })\n    .then(resp => {\n      print(resp)\n    })\n    .catch(function(err) {\n      print(err)\n      alert('Could not authenticate with Facebook.')\n    })\n  }\n\n  facebookSignout() {\n    if(FB) {\n      return new Promise((res, rej) => {\n        FB.logout((resp) => {\n          print(resp)\n          res(resp)\n        });\n      })\n    }\n    else\n      return Promise.reject()\n  }\n\n}\n","import Auth from './auth.js'\nvar print = console.log.bind(console)\n\n\nvar googleScriptSrc = '//apis.google.com/js/platform.js'\nvar facebookScriptSrc = '//connect.facebook.net/en_US/sdk.js'\n\nvar gg = new Auth({provider: 'google', scriptSrc:googleScriptSrc, cred:{\n    'clientId': '32902065428-sbal87ccp0eedjoo2opcq0tr22ha3884.apps.googleusercontent.com',\n    'scope': 'profile email'\n  }})\n\nvar fb = new Auth({provider: 'facebook', scriptSrc:facebookScriptSrc, cred:{\n    'appId': '126309204593715',\n    'cookie': true,\n    'xfbml': true,\n    'version': 'v2.9',\n    'scope': 'email'\n  }})\n\n\nwindow.gg = gg\nwindow.fb = fb\n"],"names":["b64EncodeUnicode","str","btoa","encodeURIComponent","replace","toSolidBytes","match","p1","String","fromCharCode","loadScript","url","id","script","document","getElementById","Promise","resolve","createElement","setAttribute","head","getElementsByTagName","p","res","rej","onload","ev","onerror","src","append","print","console","log","bind","Auth","provider","scriptSrc","cred","signin","googleSignin","signout","googleSignout","facebookSignin","facebookSignout","googleUser","ga","currentUser","get","googleIsIn","isSignedIn","googleIsOut","isIn","self","then","s","load","gapi","auth2","init","getAuthInstance","grantOfflineAccess","resp","fetch","code","all","json","ok","catch","err","signOut","reject","user","hasGrantedScopes","scope","facebookUser","FB","login","status","authResponse","return_scopes","accessToken","logout","googleScriptSrc","facebookScriptSrc","gg","fb","window"],"mappings":";;;AAAA;AACA,AAAO,SAASA,gBAAT,CAA0BC,GAA1B,EAA+B;SAC7BC,KAAKC,mBAAmBF,GAAnB,EAAwBG,OAAxB,CAAgC,iBAAhC,EACV,SAASC,YAAT,CAAsBC,KAAtB,EAA6BC,EAA7B,EAAiC;WACxBC,OAAOC,YAAP,CAAoB,OAAOF,EAA3B,CAAP;GAFQ,CAAL,CAAP;;;AAMF,AAAO,SAASG,UAAT,CAAoBC,GAApB,EAAyB;MAC1BC,KAAKZ,iBAAiBW,GAAjB,CAAT;MACIE,SAASC,SAASC,cAAT,CAAwBH,EAAxB,CAAb;MACGC,MAAH,EACE,OAAOG,QAAQC,OAAR,CAAgBJ,MAAhB,CAAP;WACOC,SAASI,aAAT,CAAuB,QAAvB,CAAT;SACOC,YAAP,CAAoB,OAApB,EAA6B,EAA7B;SACOA,YAAP,CAAoB,OAApB,EAA6B,EAA7B;MACIC,OAAON,SAASO,oBAAT,CAA8B,MAA9B,EAAsC,CAAtC,CAAX;MACIC,IAAI,IAAIN,OAAJ,CAAY,UAASO,GAAT,EAAcC,GAAd,EAAmB;WAC9BZ,EAAP,GAAYA,EAAZ;WACOa,MAAP,GAAgB,UAASC,EAAT,EAAa;UACvBb,MAAJ;KADF;WAGOc,OAAP,GAAiB,UAASD,EAAT,EAAa;UACxBb,MAAJ;KADF;WAGOe,GAAP,GAAajB,GAAb;SACKkB,MAAL,CAAYhB,MAAZ;GATM,CAAR;SAWOS,CAAP;;;AC3BF,IAAIQ,UAAQC,QAAQC,GAAR,CAAYC,IAAZ,CAAiBF,OAAjB,CAAZ;;AAGA,AAAe,MAAMG,IAAN,CAAW;cACZ,EAACC,QAAD,EAAWC,SAAX,EAAsBC,IAAtB,EAAZ,EAAyC;QACpC,EAAEF,YAAYC,SAAZ,IAAyBC,IAA3B,CAAH,EACE,MAAM,+CAAN;;SAEGF,QAAL,GAAgBA,QAAhB;SACKC,SAAL,GAAiBA,SAAjB;SACKC,IAAL,GAAYA,IAAZ;;QAEGF,YAAY,QAAf,EAAyB;WAClBG,MAAL,GAAc,KAAKC,YAAnB;WACKC,OAAL,GAAe,KAAKC,aAApB;KAFF,MAIK,IAAGN,YAAY,UAAf,EAA2B;WACzBG,MAAL,GAAc,KAAKI,cAAnB;WACKF,OAAL,GAAe,KAAKG,eAApB;KAFG,MAIA;YACG,sBAAsBR,QAA5B;;;;MAIAS,UAAJ,GAAiB;QACZ,KAAKC,EAAR,EACE,OAAO,KAAKA,EAAL,CAAQC,WAAR,CAAoBC,GAApB,EAAP,CADF,KAGE,OAAO,IAAP;;;MAGAC,UAAJ,GAAiB;QACZ,KAAKH,EAAR,EACE,OAAO,KAAKA,EAAL,CAAQI,UAAR,CAAmBF,GAAnB,EAAP,CADF,KAGE;;;MAGAG,WAAJ,GAAkB;WACT,CAAC,KAAKC,IAAb;;;iBAGa;QACTC,OAAO,IAAX;WACO1C,WAAW0C,KAAKhB,SAAhB,EACNiB,IADM,CACDC,KAAK;aACF,IAAItC,OAAJ,CAAY,UAASO,GAAT,EAAcC,GAAd,EAAmB;aAC/B+B,IAAL,CAAU,OAAV,EAAmB,YAAW;;SAA9B;OADK,CAAP;KAFK,EAMNF,IANM,CAMD,MAAM;aACHG,KAAKC,KAAL,CAAWC,IAAX,CAAgBN,KAAKf,IAArB,EAA2BgB,IAA3B,EAAP;KAPK,EASNA,IATM,CASD,MAAM;WACLR,EAAL,GAAUW,KAAKC,KAAL,CAAWE,eAAX,EAAV;aACOP,KAAKP,EAAL,CAAQe,kBAAR,EAAP;KAXK,EAaNP,IAbM,CAaDQ,QAAQ;aACLC,MAAM,YAAN,EAAoB;gBACjB,KADiB;qBAEZ,SAFY;iBAGhB;8BACa,OADb;2BAEU,YAAYD,KAAKE;;OAL/B,CAAP;KAdK,EAuBNV,IAvBM,CAuBDQ,QAAQ7C,QAAQgD,GAAR,CAAY,CAACH,IAAD,EAAOA,KAAKI,IAAL,EAAP,CAAZ,CAvBP,EAwBNZ,IAxBM,CAwBD,CAAC,CAACQ,IAAD,EAAOI,IAAP,CAAD,KAAkB;UACnB,CAACJ,KAAKK,EAAT,EACE,MAAMD,IAAN;aACKA,IAAP;KA3BK,EA6BNZ,IA7BM,CA6BDQ,QAAQ;cACNA,IAAN;KA9BK,EAgCNM,KAhCM,CAgCAC,OAAO;cACNA,GAAN;YACM,qCAAN;KAlCK,CAAP;;;kBAsCc;QACXZ,QAAQA,KAAKC,KAAhB,EAAuB;aACdD,KAAKC,KAAL,CAAWE,eAAX,GAA6BU,OAA7B,EAAP;KADF,MAIE,OAAOrD,QAAQsD,MAAR,EAAP;;;uBAGiB;QAChB,KAAKC,IAAR,EACE,OAAO,KAAKA,IAAL,CAAUC,gBAAV,CAA2B,KAAKnC,IAAL,CAAUoC,KAArC,CAAP,CADF,KAGE,OAAO,IAAP;;;MAGAC,YAAJ,GAAmB;;mBAIF;QACXtB,OAAO,IAAX;WACO1C,WAAW0C,KAAKhB,SAAhB,EACNiB,IADM,CACD,UAASC,CAAT,EAAY;aACTqB,GAAGjB,IAAH,CAAQN,KAAKf,IAAb,CAAP;KAFK,EAINgB,IAJM,CAID,YAAW;aACR,IAAIrC,OAAJ,CAAY,CAACO,GAAD,EAAMC,GAAN,KAAc;WAC5BoD,KAAH,CAASf,QAAQ;cACZA,KAAKgB,MAAL,IAAe,WAAf,IAA8BhB,KAAKiB,YAAtC,EACEvD,IAAIsC,IAAJ,EADF,KAGErC,IAAIqC,IAAJ;SAJJ,EAKG,EAACY,OAAOrB,KAAKf,IAAL,CAAUoC,KAAlB,EAAyBM,eAAe,IAAxC,EALH;OADK,CAAP;KALK,EAcN1B,IAdM,CAcD,UAASQ,IAAT,EAAe;aACZC,MAAM,YAAN,EAAoB;gBACjB,KADiB;qBAEZ,SAFY;iBAGhB;8BACa,OADb;2BAEU,cAAcD,KAAKiB,YAAL,CAAkBE;;OAL9C,CAAP;KAfK,EAwBN3B,IAxBM,CAwBDQ,QAAQ7C,QAAQgD,GAAR,CAAY,CAACH,IAAD,EAAOA,KAAKI,IAAL,EAAP,CAAZ,CAxBP,EAyBNZ,IAzBM,CAyBD,CAAC,CAACQ,IAAD,EAAOI,IAAP,CAAD,KAAkB;UACnB,CAACJ,KAAKK,EAAT,EACE,MAAMD,IAAN;aACKA,IAAP;KA5BK,EA8BNZ,IA9BM,CA8BDQ,QAAQ;cACNA,IAAN;KA/BK,EAiCNM,KAjCM,CAiCA,UAASC,GAAT,EAAc;cACbA,GAAN;YACM,uCAAN;KAnCK,CAAP;;;oBAuCgB;QACbO,EAAH,EAAO;aACE,IAAI3D,OAAJ,CAAY,CAACO,GAAD,EAAMC,GAAN,KAAc;WAC5ByD,MAAH,CAAWpB,IAAD,IAAU;kBACZA,IAAN;cACIA,IAAJ;SAFF;OADK,CAAP;KADF,MASE,OAAO7C,QAAQsD,MAAR,EAAP;;;;;ACzJN,IAAIxC,QAAQC,QAAQC,GAAR,CAAYC,IAAZ,CAAiBF,OAAjB,CAAZ;;AAGA,IAAImD,kBAAkB,kCAAtB;AACA,IAAIC,oBAAoB,qCAAxB;;AAEA,IAAIC,KAAK,IAAIlD,IAAJ,CAAS,EAACC,UAAU,QAAX,EAAqBC,WAAU8C,eAA/B,EAAgD7C,MAAK;oBACvD,yEADuD;iBAE1D;KAFK,EAAT,CAAT;;AAKA,IAAIgD,KAAK,IAAInD,IAAJ,CAAS,EAACC,UAAU,UAAX,EAAuBC,WAAU+C,iBAAjC,EAAoD9C,MAAK;iBAC9D,iBAD8D;kBAE7D,IAF6D;iBAG9D,IAH8D;mBAI5D,MAJ4D;iBAK9D;KALK,EAAT,CAAT;;AASAiD,OAAOF,EAAP,GAAYA,EAAZ;AACAE,OAAOD,EAAP,GAAYA,EAAZ;;"}